This setup is for ubuntu,.NET Core and Postgres on AWS LightSail. This will install and run the twitter docker application.
It will set the docker daemon to run on boot. Your containers should start automatically becuase the docker compose
file has the containers set to restart always. 
Watchtower is also set up. Watchtower is a container that polls docker hub for new images and updates your containers sutomatically.

1. Execute from the AWS CLI. You may get errors if you don't execute them one at a time.
aws lightsail create-instances --instance-name "twitter" --availability-zone "us-east-1b" --blueprint-id "ubuntu_18_04" --bundle-id nano_2_0
aws lightsail create-disk --disk-name twitter-data --availability-zone "us-east-1b" --size-in-gb 8
aws lightsail open-instance-public-ports --port-info fromPort=8000,toPort=8000,protocol=TCP --instance-name="twitter"
aws lightsail attach-disk --disk-name twitter-data --instance-name twitter --disk-path /dev/xvdf
aws lightsail allocate-static-ip --static-ip-name "twitter-ip" 
aws lightsail attach-static-ip --static-ip-name "twitter-ip" --instance-name "twitter"
aws lightsail get-instance --instance-name "twitter"

2. SSH into the created instance and execute the script below. You can get to the terminal from the LightSail web view.
This will create a docker-compose.yml file and a setup.sh script that will set up Docker on the machine and
docker-compose up your container. It will also set up the volume you created earlier so that your database can be persisted.
You have to presee enter after pasting it to the terminal. 

sudo echo "version: '2'
services:

  web:
    container_name: 'twitter-app'
    image: 'codenesium/twitter'
    build:
      context: .
      dockerfile: DockerFile
    environment:
       - ASPNETCORE_URLS=http://+:80
       - ConnectionStrings__ApplicationDbContext=Host=twitter-db;Persist Security Info=False;User ID=postgres;Password=test;Database=twitter;
       - DatabaseProvider=POSTGRESQL
       - MigrateDatabase=true
    volumes:
      - .:/var/www/app
    ports:
     - "80:80"
    restart: always
    depends_on:
     - "db"
    networks:
      - twitter-network

  db:
    container_name: 'twitter-db'
    image: postgres:9.6-alpine
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: test
      POSTGRES_DB: twitter
    networks:
      - twitter-network
    ports:
     - "5433:5432"
    restart: always
    volumes:
         - /database/twitter:/var/lib/postgresql/data
  watchtower:
    container_name: 'watchtower'
    image: v2tec/watchtower
    restart: on-failure
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    command: --interval 30

networks:
    twitter-network:
       driver: bridge" >> docker-compose.yml;
   
sudo echo '#!/bin/bash
sudo file -s /dev/xvdf && 
sudo mkfs -t ext4 /dev/xvdf && 
sudo mkdir /database &&
sudo mkdir /database/twitter &&
sudo mount /dev/xvdf  /database/twitter && 
sudo rmdir /database/twitter/lost+found && 
sudo apt-get update && 
sudo apt-get install -y docker && 
sudo apt-get install -y docker-compose && 
sudo service docker start && 
sudo systemctl enable docker  &&
docker pull codenesium/twitter && 
sudo docker-compose up;' >> setup.sh;

chmod 755 setup.sh;
sudo sh ./setup.sh;